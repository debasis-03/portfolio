{% extends 'base.html' %}
{% load static %}

{% block title %}Projects - {{ portfolio.name|default:"Portfolio" }}{% endblock %}

{% block content %}
<!-- Projects Hero Section -->
<section class="bg-gradient-primary text-white py-5">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 mx-auto text-center">
                <h1 class="display-4 fw-bold mb-3">My Projects</h1>
                <p class="lead">A showcase of my work and the technologies I use</p>
            </div>
        </div>
    </div>
</section>

<!-- Filter Section -->
<section class="py-4 bg-light">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <div class="d-flex flex-wrap justify-content-center gap-2">
                    <button class="btn btn-outline-primary filter-btn active" data-tech="">
                        <i class="fas fa-th me-1"></i> All Projects
                    </button>
                    {% for tech in technologies %}
                        <button class="btn btn-outline-primary filter-btn" data-tech="{{ tech.name }}">
                            <i class="fas fa-tag me-1"></i> {{ tech.name }}
                        </button>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Projects Grid -->
<section class="py-5">
    <div class="container">
        <div id="projects-container">
            <div class="row g-4" id="projects-grid">
                {% for project in projects %}
                    <div class="col-lg-4 col-md-6 project-item" data-technologies="{% for tech in project.technologies.all %}{{ tech.name|lower }} {% endfor %}">
                        <div class="card h-100 shadow-sm project-card">
                            {% if project.image %}
                                <img src="{{ project.image.url }}" class="card-img-top" alt="{{ project.title }}" style="height: 250px; object-fit: cover;">
                            {% endif %}
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title">{{ project.title }}</h5>
                                <p class="card-text text-muted flex-grow-1">{{ project.description|truncatewords:20 }}</p>
                                <div class="mb-3">
                                    {% for tech in project.technologies.all %}
                                        <span class="badge me-1" style="background-color: {{ tech.color }};">{{ tech.name }}</span>
                                    {% endfor %}
                                </div>
                                <div class="d-flex gap-2">
                                    <a href="{% url 'project_detail' project.id %}" class="btn btn-outline-primary btn-sm">
                                        <i class="fas fa-eye me-1"></i> View Details
                                    </a>
                                    {% if project.live_url %}
                                        <a href="{{ project.live_url }}" target="_blank" class="btn btn-primary btn-sm">
                                            <i class="fas fa-external-link-alt me-1"></i> Live Demo
                                        </a>
                                    {% endif %}
                                    {% if project.source_url %}
                                        <a href="{{ project.source_url }}" target="_blank" class="btn btn-outline-secondary btn-sm">
                                            <i class="fab fa-github me-1"></i> Source
                                        </a>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                {% empty %}
                    <div class="col-12 text-center py-5">
                        <i class="fas fa-code fa-3x text-muted mb-3"></i>
                        <h4 class="text-muted">No projects yet</h4>
                        <p class="text-muted">Add your projects through the admin panel to see them here.</p>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
$(document).ready(function() {
    // Filter functionality
    $('.filter-btn').click(function() {
        $('.filter-btn').removeClass('active');
        $(this).addClass('active');
        
        var selectedTech = $(this).data('tech').toLowerCase();
        
        if (selectedTech === '') {
            $('.project-item').show();
        } else {
            $('.project-item').each(function() {
                var projectTechs = $(this).data('technologies');
                if (projectTechs && projectTechs.includes(selectedTech)) {
                    $(this).show();
                } else {
                    $(this).hide();
                }
            });
        }
    });
    
    // AJAX filtering (alternative approach)
    function filterProjects(techName) {
        $.ajax({
            url: '{% url "filter_projects" %}',
            data: { 'tech': techName },
            success: function(data) {
                var projectsHtml = '';
                if (data.projects.length > 0) {
                    data.projects.forEach(function(project) {
                        projectsHtml += '<div class="col-lg-4 col-md-6">';
                        projectsHtml += '<div class="card h-100 shadow-sm project-card">';
                        if (project.image_url) {
                            projectsHtml += '<img src="' + project.image_url + '" class="card-img-top" alt="' + project.title + '" style="height: 250px; object-fit: cover;">';
                        }
                        projectsHtml += '<div class="card-body d-flex flex-column">';
                        projectsHtml += '<h5 class="card-title">' + project.title + '</h5>';
                        projectsHtml += '<p class="card-text text-muted flex-grow-1">' + project.short_description + '</p>';
                        projectsHtml += '<div class="mb-3">';
                        project.technologies.forEach(function(tech) {
                            projectsHtml += '<span class="badge me-1" style="background-color: ' + tech.color + ';">' + tech.name + '</span>';
                        });
                        projectsHtml += '</div>';
                        projectsHtml += '<div class="d-flex gap-2">';
                        if (project.live_url) {
                            projectsHtml += '<a href="' + project.live_url + '" target="_blank" class="btn btn-primary btn-sm"><i class="fas fa-external-link-alt me-1"></i> Live Demo</a>';
                        }
                        if (project.source_url) {
                            projectsHtml += '<a href="' + project.source_url + '" target="_blank" class="btn btn-outline-secondary btn-sm"><i class="fab fa-github me-1"></i> Source</a>';
                        }
                        projectsHtml += '</div></div></div></div>';
                    });
                } else {
                    projectsHtml = '<div class="col-12 text-center py-5"><i class="fas fa-code fa-3x text-muted mb-3"></i><h4 class="text-muted">No projects found</h4><p class="text-muted">Try selecting a different technology filter.</p></div>';
                }
                $('#projects-grid').html(projectsHtml);
            }
        });
    }
});
</script>
{% endblock %}
